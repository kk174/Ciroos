# ============================================
# outputs.tf - Output Values
# ============================================
# These values are displayed after "terraform apply"
# and can be used by other Terraform configurations
#
# ANALOGY: Like a function's return values

# ------------------------------
# VPC Outputs
# ------------------------------

output "vpc_id" {
  description = "ID of the VPC"
  value       = module.vpc.vpc_id
}

output "private_subnets" {
  description = "List of private subnet IDs"
  value       = module.vpc.private_subnets
}

output "public_subnets" {
  description = "List of public subnet IDs"
  value       = module.vpc.public_subnets
}

# ------------------------------
# EKS Outputs
# ------------------------------

output "cluster_name" {
  description = "Name of the EKS cluster"
  value       = module.eks.cluster_name
}

output "cluster_endpoint" {
  description = "Endpoint URL for the EKS cluster API"
  value       = module.eks.cluster_endpoint
}

output "cluster_security_group_id" {
  description = "Security group ID attached to the EKS cluster"
  value       = module.eks.cluster_security_group_id
}

# This is the command you'll run to configure kubectl
output "configure_kubectl" {
  description = "Command to configure kubectl for this cluster"
  value       = "aws eks update-kubeconfig --region ${var.aws_region} --name ${module.eks.cluster_name}"
}

# ------------------------------
# RDS Outputs
# ------------------------------

output "rds_endpoint" {
  description = "RDS instance endpoint"
  value       = module.rds.db_instance_endpoint
}

output "rds_port" {
  description = "RDS instance port"
  value       = module.rds.db_instance_port
}

output "rds_database_name" {
  description = "Name of the database"
  value       = module.rds.db_instance_name
}

# Connection string for applications
output "rds_connection_string" {
  description = "PostgreSQL connection string (without password)"
  value       = "postgresql://${var.db_username}:PASSWORD@${module.rds.db_instance_endpoint}/${var.db_name}"
  sensitive   = false  # Password is not included
}

# ------------------------------
# ElastiCache Outputs
# ------------------------------

output "redis_endpoint" {
  description = "ElastiCache Redis endpoint"
  value       = aws_elasticache_cluster.redis.cache_nodes[0].address
}

output "redis_port" {
  description = "ElastiCache Redis port"
  value       = aws_elasticache_cluster.redis.cache_nodes[0].port
}

output "redis_connection_string" {
  description = "Redis connection string"
  value       = "redis://${aws_elasticache_cluster.redis.cache_nodes[0].address}:${aws_elasticache_cluster.redis.cache_nodes[0].port}"
}

# ------------------------------
# S3 Outputs
# ------------------------------

output "logs_bucket_name" {
  description = "Name of the S3 logs bucket"
  value       = aws_s3_bucket.logs.id
}

output "logs_bucket_arn" {
  description = "ARN of the S3 logs bucket"
  value       = aws_s3_bucket.logs.arn
}

# ------------------------------
# Summary Output
# ------------------------------

output "infrastructure_summary" {
  description = "Summary of created infrastructure"
  value = <<-EOT

    ╔══════════════════════════════════════════════════════════════════╗
    ║           CIROOS DEMO INFRASTRUCTURE - CREATED!                  ║
    ╠══════════════════════════════════════════════════════════════════╣
    ║                                                                  ║
    ║  EKS Cluster:  ${module.eks.cluster_name}
    ║  Region:       ${var.aws_region}
    ║                                                                  ║
    ║  NEXT STEPS:                                                     ║
    ║  1. Configure kubectl:                                           ║
    ║     aws eks update-kubeconfig --region ${var.aws_region} --name ${module.eks.cluster_name}
    ║                                                                  ║
    ║  2. Verify connection:                                           ║
    ║     kubectl get nodes                                            ║
    ║                                                                  ║
    ║  3. Deploy the microservices (next step!)                        ║
    ║                                                                  ║
    ╚══════════════════════════════════════════════════════════════════╝

  EOT
}

# ============================================
# WHAT YOU LEARNED:
# ============================================
# - Outputs display values after terraform apply
# - sensitive = true hides values (for passwords)
# - Outputs can reference module values: module.eks.cluster_name
# - You can create formatted strings with <<-EOT (heredoc)
# - Outputs can be used by other Terraform configs
